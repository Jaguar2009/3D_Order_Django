{% extends 'base.html' %}

{% block title %}{{ post.title }}{% endblock %}
{% load static %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
{% endblock %}

{% block body %}
<div class="outer-card">
  <div class="inner-card">
    <!-- –í–µ—Ä—Ö–Ω—ñ–π –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª -->
    <div class="header">
      <a href="{% url 'user_profile' user_id=post.author.id %}">
          <img src="{{ user.avatar.url }}" alt="Avatar" class="avatar">
      </a>
      <h3><a href="{% url 'user_profile' user_id=post.author.id %}" class="author-name">{{ post.author.first_name }}</a></h3>

      <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
      <button class="delete-btn" id="openModal">
        üóë –í–∏–¥–∞–ª–∏—Ç–∏
      </button>

      <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑ —ñ–∫–æ–Ω–∫–æ—é -->
      <a href="{% url 'edit_post' post.id %}" class="edit-btn">
          ‚úè –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
      </a>

      <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫—É–±–∞ -->
      <form action="{% url 'toggle_cube' post.id %}" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="add-cube-btn">
              {% if user in post.likes.all %}
                  ‚ùå –í—ñ–¥–Ω—è—Ç–∏ –∫—É–±
              {% else %}
                  üü© –î–æ–¥–∞—Ç–∏ –∫—É–±
              {% endif %}
          </button>
      </form>

    <span>–ö—É–±–∏: {{ post.cubes }}</span>

    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <p>–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø–æ—Å—Ç?</p>
        <form method="POST" action="{% url 'delete_post' post.id %}">
          {% csrf_token %}
          <div class="modal-buttons">
            <button type="submit" class="confirm-delete">–¢–∞–∫, –≤–∏–¥–∞–ª–∏—Ç–∏</button>
            <button type="button" class="close-modal" id="closeModal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          </div>
        </form>
      </div>
    </div>

    <!-- –ó–æ–≤–Ω—ñ—à–Ω—è –∫–∞—Ä—Ç–∫–∞ –¥–ª—è –º–µ–¥—ñ–∞ —Ç–∞ –∫–Ω–æ–ø–æ–∫ -->
    <div class="carousel-outer-card">
      <!-- –ö–∞—Ä—Ç–∫–∞ –∑ –∫–Ω–æ–ø–∫–∞–º–∏ —ñ –º–µ–¥—ñ–∞ -->
      <div class="carousel-container">
        <!-- –ö–∞—Ä—Ç–∫–∞ –∑ –º–µ–¥—ñ–∞ -->
        <div class="media-card">
          <div id="carouselExample" class="carousel">
            <div class="carousel-inner">
              {% for media in media_files %}
              <div class="carousel-item{% if forloop.first %} active{% endif %}">
                <img src="{{ media.file.url }}" class="d-block" alt="Media">
              </div>
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
        <div class="carousel-controls">
          <button class="carousel-control-prev" id="prevBtn" aria-label="Previous">
            &#10094;
          </button>
          <button class="carousel-control-next" id="nextBtn" aria-label="Next">
            &#10095;
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="outer-card">
<!-- –ö–∞—Ä—Ç–∫–∞ –∑ –¥–µ—Ç–∞–ª—è–º–∏ —Ç–∞ —Ñ–∞–π–ª–∞–º–∏ -->
<div class="details-card">
  <div class="tabs">
    <button class="tab-button active" data-target="details">–î–µ—Ç–∞–ª—ñ –º–æ–¥–µ–ª—ñ</button>
    <button class="tab-button" data-target="files">–§–∞–π–ª–∏</button>
    <button class="tab-button" data-target="comments">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</button>
  </div>

  <!-- –î–µ—Ç–∞–ª—ñ –º–æ–¥–µ–ª—ñ -->
  <div class="tab-pane details active" id="details">
    <h3>–î–µ—Ç–∞–ª—ñ –º–æ–¥–µ–ª—ñ</h3>
    <p class="model-description">{{ post.description }}</p>
    <p><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> <span class="category">{{ post.category }}</span></p>
  </div>

  <!-- 3D —Ñ–∞–π–ª–∏ -->
  <div class="tab-pane files" id="files">
    <h2>3D —Ñ–∞–π–ª–∏:</h2>
    {% for object_3d in object_3d_files %}
      <div class="file-item">
        <span class="file-name">{{ object_3d.file.name }}</span> <!-- –ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É -->
        <a href="{{ object_3d.file.url }}" class="download-link" download>–°–∫–∞—á–∞—Ç–∏ 3D —Ñ–∞–π–ª</a>
      </div>
    {% empty %}
      <p class="no-files">3D —Ñ–∞–π–ª–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ.</p>
    {% endfor %}
  </div>

  <!-- –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
  <div class="tab-pane comments" id="comments">
    <h3>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h3>
    <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
    <form method="post" action="{% url 'add_comment' post.id %}">
        {% csrf_token %}
        <div class="comment-input-container">
            <textarea name="content" class="comment-input" rows="3" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –∫–æ–º–µ–Ω—Ç–∞—Ä..." required></textarea>
            <button type="submit" class="send-button">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
        </div>
    </form>

    <!-- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
    <div class="comments-section">
        {% for comment in comments %}
            <div class="comment-card">
                <div class="comment-header">
                    <img src="{{ comment.author.avatar.url }}" alt="Avatar">
                    <strong>{{ comment.author.first_name }}</strong>
                    {% if comment.author == post.author %}
                        <span class="post-author">–ê–≤—Ç–æ—Ä –ø–æ—Å—Ç–∞</span>
                    {% endif %}
                </div>
                <p>{{ comment.content }}</p>
                <small>{{ comment.created_at|date:"d.m.Y H:i" }}</small>

                <!-- –ö–Ω–æ–ø–∫–∏ -->
                <div class="comment-actions">
                    <form class="cube-form" data-comment-id="{{ comment.id }}" action="{% url 'toggle_cube_for_comment' comment.id %}" method="post">
                        {% csrf_token %}
                        <span class="cube-button" data-comment-id="{{ comment.id }}">
                            üßä <span class="cube-count">{{ comment.cubes }}</span>
                        </span>
                    </form>
                    {% if comment.author == user %}
                        <button class="delete-comment-button" data-comment-id="{{ comment.id }}">üóëÔ∏è</button>
                    {% endif %}
                    <button class="reply-button" data-comment-id="{{ comment.id }}">–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
                </div>

                <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
                <div id="deleteCommentModal" class="modal">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h2>–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –∫–æ–º–µ–Ω—Ç–∞—Ä?</h2>
                        <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è -->
                        <form id="delete-comment-form" action="{% url 'delete_comment' comment.id %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" id="comment_id" value="{{ comment.id }}">
                            <button type="submit" class="confirm-delete-button">–¢–∞–∫, –≤–∏–¥–∞–ª–∏—Ç–∏</button>
                            <button type="button" class="cancel-delete-button">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                        </form>
                    </div>
                </div>


                <!-- –§–æ—Ä–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ -->
                <div class="reply-form" id="reply-form-{{ comment.id }}" style="display: none;">
                    <form method="post" action="{% url 'add_comment' post.id %}">
                        {% csrf_token %}
                        <div class="comment-input-container">
                            <textarea name="content" class="comment-input" rows="2" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å..." required></textarea>
                            <button type="submit" class="send-button">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
                        </div>
                        <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    </form>
                </div>

                <!-- –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä -->
                {% for reply in replies %}
                    {% if reply.parent.id == comment.id %}
                        <div class="reply-card">
                            <div class="comment-header">
                                <img src="{{ reply.author.avatar.url }}" alt="Avatar">
                                <strong>{{ reply.author.first_name }}</strong>
                                {% if reply.author == post.author %}
                                    <span class="post-author">–ê–≤—Ç–æ—Ä –ø–æ—Å—Ç–∞</span>
                                {% endif %}
                            </div>
                            <p><span class="reply-to">@{{ reply.parent.author.first_name }}</span> {{ reply.content }}</p>
                            <small>{{ reply.created_at|date:"d.m.Y H:i" }}</small>

                            <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π -->
                            <div class="comment-actions">
                                <form class="cube-form" data-comment-id="{{ reply.id }}" action="{% url 'toggle_cube_for_comment' reply.id %}" method="post">
                                    {% csrf_token %}
                                    <span class="cube-button" data-comment-id="{{ reply.id }}">
                                        üßä <span class="cube-count">{{ reply.cubes }}</span>
                                    </span>
                                </form>
                                {% if reply.author == user %}
                                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ -->
                                <button class="delete-reply-button" data-reply-id="{{ reply.id }}">üóëÔ∏è</button>
                                {% endif %}
                                <button class="reply-button" data-comment-id="{{ reply.id }}">–í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏</button>
                            </div>

                            <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è -->
                            <div id="deleteReplyModal" class="modal">
                                <div class="modal-content">
                                    <span class="close-modal">&times;</span>
                                    <h2>–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å?</h2>
                                    <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ -->
                                    <form id="delete-reply-form" action="{% url 'delete_reply' reply.id %}" method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="reply_id" id="reply_id">
                                        <button type="submit" class="confirm-delete-button">–¢–∞–∫, –≤–∏–¥–∞–ª–∏—Ç–∏</button>
                                        <button type="button" class="cancel-delete-button">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                                    </form>
                                </div>
                            </div>

                            <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ -->
                            <div class="reply-form" id="reply-form-{{ reply.id }}" style="display: none;">
                                <form method="post" action="{% url 'add_comment' post.id %}">
                                    {% csrf_token %}
                                    <div class="comment-input-container">
                                        <textarea name="content" class="comment-input" rows="2" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å..." required></textarea>
                                        <button type="submit" class="send-button">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
                                    </div>
                                    <input type="hidden" name="parent_id" value="{{ reply.id }}">
                                </form>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% empty %}
            <p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤.</p>
        {% endfor %}
    </div>

</div>




</div>
</div>

<script src="{% static 'js/post_detail.js' %}"></script>

{% endblock %}
